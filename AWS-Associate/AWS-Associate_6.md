## EBS 개요

EBS (Elastic Block Store) : 인스턴스가 실행 중인 동안 연결 간으한 네트워크 드라이브(물리 드라이브 X)

→ 인스턴스가 종료 되었음에도 데이터를 지속

- CCP 레벨 : 하나의 EBS는 하나의 EC2 인스턴스에 마운트 가능
- 어소시에이트 레벨 : 일부 EBS 다중 연결

### EBS 볼륨

- EBS 볼륨을 생성 할때는 특정 가용 영역에서만 가능
- USB 스틱과 같이 한 컴퓨터에 꺼내 다른 컴퓨터에 꽂는 장치와 (물리적으로 연결 X)
    - 네트워크로 연결된다
    - 네트워크 연결을 때문에 지연이 생길 수 있다.
    - EC2 인스턴스와 분리가 가능
    - 특정 가용영역에 고정
        - 스냅샷을 이용하여 다른 가용 영역으로 이동이 가능
    - 용량을 미리 고정 해야함
- 한 인스턴스에 여러 EBS 볼륨이 연결될 수 있지만, 한 EBS 볼륨은 여러 인스턴스에 연결될 수 없다.
- 기본적으로 루트 EBS 볼륨은 인스턴스 종료와 함께 삭제 되도록 설정
    - 삭제 속성 활성화/비활성화 가능

## EBS 스냅샷

EBS 볼륨의 특정 시점에서의 백업이다

EBS 스냅샷을 다른 가용 영역, 다른 리전에 복사가 가능

**스냅샷의 기능**

- EBS 스냅샷 아카이브
    - 스냅샷을 75% 저렴한 아카이브 티어를 사용
    - 아카이브를 복원하는데 24~72 시간이 걸림
- EBS 스냅샷을 위한 휴지통 생성
    - 영구적으로 삭제하는 대신 휴지통에 보관
        - 보관 기간 1일 ~ 1년
- 빠른 스냅샷 복원
    - 스냅샷이 매우 클 때 EBS 볼륨을 초기화 해야할 때 사용
    - 매우 빠르게 인스턴스화 해야할 때
    - 비용이 많이 들기 때문에 사용할 때 주의
    

## AMI (Amazon Machine Image)

SW 구성에 대해 운영체제를 정의 및 설정하는 도구

+ 모니터링 도구 설정 가능

- AMI 를 사용하면 부팅과 구성에 시간이 단축
    - ㄹ
- AMI 를 자체적으로 구성 가능
- 특정 리전에 맞게 구축 가능
    - 글로벌 인프라 활용
- AMI를 직접 커스텀해 사용이 가능
    - 내가 만든 AMI를 판매 가능
- AWS 가 제공하는 공용 AMI를 자주 사용하지만 마켓 플레이스에서 다른 사용자가 만들어 판매하는 AMI를 구매하여 사용할 수 있다.

## Instance Store

<aside>
💡 EC2 인스턴스는 네트워크 드라이브로 연결된다. EC2 인스턴스는 가상 머신이지만 실제로는 하드웨어 서버에 연결되어 있다. 결국 물리적인 디스크 공간을 갖는다. 이는 EC2 인스턴스 스토어라고 불리며 연결된 하드웨어 드라이브를 가리킨다.

</aside>

인스턴스 스토어는 I/O 성능 향상을 위해 사용될 수 있다.

매우 향상된 디스크 성능이 필요할 때 사용한다.

## EBS 볼륨 타입

총 6개의 유형이 있다 

### gp2 / gp3

- 부팅 볼륨으로 사용
- 범용 SSD 볼륨으로 다양한 워크로드에 대해 가격과 성능의 절충안
- gp2 : 짧은 지연 시간이 장점, 효율적인 비용의 스토리지
    - 1GB에서 16TB까지 다양
    - 최대 3000 IOSP
        - 볼륨의 크기를 늘릴때 x3 으로 IOSP가 증가(최대 16,000 IOSP)
            - `ex) 5500GB 볼륨일 경우 16,000 IOSP 가 초과하기 때문에 성능 저하`
    
- gp3 :  최신 세대의 볼륨
    - 기본 성능으로 3,000 IOPS
        - 독자적으로 처리량 설정 가능
    - 처리량 : 초당 125MB  (1,000MB/s까지 증가 가능)
    - IOPS는 최대 16,000

### io1 / io2

- 4GB에서 16TB
- 부팅 볼륨으로 사용
- 최고 성능을 자랑하는 SSD 볼륨으로
- 미션 크리티컬이자 지연 시간이 낮고 대용량의 워크로드
- Nitro EC2 인스턴스에서는 최대 64,000 IOPS까지 가능
- 스토리지 크기와 처리량 독자적으로 증가

### st1 볼륨 / sc1 볼륨

- 가장 비용이 적게 드는 HDD 볼륨
- 부팅 볼륨으로 사용 X
- 최대 16TB까지 확장
- st1 : 처리량 최적화 HDD
    - 빅 데이터나 데이터 웨어하우징 로그 처리에 적합
- sc1 : 콜드 HDD
    - 아카이브 데이터용
    - 접근 빈도가 낮은 워크로드를 위해 설계
    

## EBS 다중 연결

- EBS 볼륨은 다중 첨부 기능을 사용할 수 있다.
- 동일한 가용 영역에 있는 여러개의 EC2 인스턴스에 첨부할 수 있다.
- io1, io2 제품에서만 가능
    - 고성능 볼륨에 대한 정체 읽기 및 쓰기 권한을 갖는다.
    - **하나의 볼륨은 최대 16개의 인스턴스에 부착할 수 있다.**
- 클러스터를 인식할 수 있는 파일시스템을 사용해야 한다.

## EFS (Elastic File System) 탄력적 파일 시스템

EFS는 관리형 NFS(네트워크 파일 시스템)이다 

- 많은 EC2 인스턴스에 마운트 될 수 있다.
- 가용성이 높고 확장성이 뛰어나다.
- 비용이 높다. GP2 EBS 볼륨의 약 3배
- 사용한 만큼 지불 (프로비저닝 X)



- EFS를 통해 동일한 네트워크 파일 시스템에 동시에 연결할 수 있다
- 콘텐츠 관리, 웹 서비스 데이터 공유, 워드 프레스에 사용된다.
- 내부적으로 NFS 프로토콜을 사용하고 EFS에 대한 엑세스를 제어하려면 보안 그룹을 설정해야 한다.
- 이 기능은 Windows에서는 사용할 수 없다
    - Linux 기반 AMI에서만 사용이 가능
- KMS를 사용하여 (EBS 볼륨)미사용 데이터를 암호화 할 수 있다.
- POSIX 시스템을 사용하여, 표준 API도 있다
- 용량을 미리 계획하지 않고 자동으로 확장하면 사용이 가능하다
    - 사용한 만큼 비용을 지불

### **성능**

- 수천개의 NFS 클라이언트와 10GB 이상의 처리량이 가능
- 페타 바이트 규모의 네트워크 파일 시스템으로 자동으로 확장이 가능

**범용 모드(기본 값)**

- 웹 서버, CMS 등과 같이 지연시간에 민감한 경우 사용
    - Max I/O : 지연 시간이 더 긴 파일 시스템 이지만, 처리량이 크고 병렬성이 좋다

**버스팅**

- 1테라 바이트 경우 초당 50MB에 초당 100MB의 버스트
- 프로비저닝 : 스토리지 크기에 관계없이 처리량 설정 가능

**엘라스틱**

- 워크로드에 따라서 처리량을 자동으로 확장
- 워크로드가 예측할 수 없을 때 매우 유용하다.

### **스토리지**

- 스토리지 계층을 설정할 수 있다.
    - 며칠 후 파일을 다른 계층으로 옮길 수 있는 기능
- 표준 계층 : 자주 엑세스하는 파일을 위한 계층
- EFS-IA : 자주 엑세스 하지 않는 계층
    - 파일을 검색하는 경우 비용이 많이 발생한다
    - 하지만 저장하는 비용은 낮다.
    - 생명 주기 정책을 사용
    
    <aside>
    💡 생명 주기 정책 예시)
    자주 사용하는 파일이 EFS 표준 계층에 있을 때 이후 60일 이상 엑세스 되지 않았을 경우 적절한 생명 주기 정책을 통해  EFS-IA 계층으로 이동하여 비용을 절감할 수 있다.
    
    </aside>
    

**가용성과 내구성 측면**

<aside>
💡 EFS를 다중 AZ로 설정하면 프로덕션 사용 사례에 매우 적합. 가용 영역이 다운되더라도 EFS 파일 시스템에 영향을 미치지 않기 때문에. 하지만 개발용 하나의 EFS 파일 시스템을 사용한다. 하나의 AZ 에만 있고 백업은 기본적으로 사용하도록 설정되어 있다.  자주 엑세스 하지 않는 스토리지 계층과 호화되지 않는다. 따라서 EFS 하나의 영역을 EFS-IA 라고 부른다. 이를 사용하면 90% 비용 절감을 할 수 있다.

</aside>

### 언제 EFS 를 사용해야 하나? (시험 출제)

<aside>
💡 Amazon EFS (Elastic File System)는 여러 EC2 인스턴스 간에 파일 시스템을 공유할 때 사용합니다. 자동 확장과 고가용성을 제공하며, NFS 프로토콜을 지원합니다. 주로 다중 인스턴스 파일 공유, 데이터 분석, 미디어 처리 등에서 활용됩니다. 관리형 서비스로 파일 시스템 관리가 간소화됩니다.

</aside>

### 요구사항을 검증하고 준수 하려면 EFS 네트워크 파일 시스템에서 어떤 옵션을 설정 해야하나? (시험 출제)

<aside>
💡 EFS 네트워크 파일 시스템에서 요구사항을 검증하고 준수하려면 다음 옵션을 설정해야 합니다: **암호화 (전송 중 및 저장 중)**, **네트워크 액세스 제어 (보안 그룹 및 NFS 액세스 포인트)**, **IAM 정책**, **파일 시스템 정책**, **라이프사이클 관리**. 이를 통해 보안, 접근 제어, 비용 관리 요구사항을 충족할 수 있습니다.

</aside>

### EFS vs EBS

**EBS 볼륨**

- 한번에 한 인스턴스만 연결된다
    - 다중 연결 기능은 io1 또는 io2 라는 유형의 볼륨을 사용하는 극단적인 경우
- EBS 볼륨은 AZ(가용 영역)에 고정된다
- gp2 유형의 볼륨은 디스크 크기가 증가해야 IO가 증가한다
- gp3 와 io1 유형은 볼륨의 크기와 무관하게 IO를 증가 시킬수 있다.
- AZ 간에 EBS 볼륨을 옮기려면 스냅샷을 이용
    - EBS 스냅샷에 저장되고 이 스냅샷을 다른 AZ에 복원할 수 있다.
- EBS 볼륨 백업이 IO를 사용하므로 애플리케이션이 많은 트래픽을 처리하고 있을 경우에는 사용하면 안된다.
- EC2 인스턴스가 종료되면 EBS 루트 볼륨도 종료된다.

**EFS** 

- 네트워크 파일 시스템
- 서로 다른 AZ(가용 영역)에 수백개의 인스턴스에 연결이 가능하다.
- AZ의 여러 대상을 가질 수 있다
- 여러 인스턴스가 하나의 파일 시스템을 공유
- Linux 인스턴스에만 사용 가능
- EBS 보다 가격이 높음
    - EFS-IA 를 이용해 비용절감