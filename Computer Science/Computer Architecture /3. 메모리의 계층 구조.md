## 메모리의 계층 구조

![image](https://github.com/user-attachments/assets/ca13ef90-5d67-4635-abdc-fc957225bd0a)

- 위로 갈 수록 속도가 빠르고, 용량이 작다

우리의 작업을 수행하는 프로세서는 보조기억장치, 즉 디스크에 있는 파일에 직접 접근할 수 없다. 디스크에 있는 작업을 메인 메모리 상에 올리고, 메인 메모리에서 가져와서 연산을 한다

### Why?

디스크와 프로세서가 작업을 처리할 수 있는 속도에 큰 차이가 있기 때문에,

이로 인한 **디스크 입출력 병목현상**을 해결하기 위해, `중간에 메인 메모리`를 두고 이용

**캐시 메모리는 메인 메모리와 CPU 사이의 속도 차이를 줄이기 위해, 사이에서 임시로 값을 저장**

## 캐시 메모리

**🔎캐시 메모리란?**

속도가 빠른 장치와 느린 장치에서 속도차이에 따른 병목현상을 줄이기 위한 메모리 

- 사용 목적 : 속도 향상
- 단점 : 적은 용량, 비용이 높음
![image](https://github.com/user-attachments/assets/ba7542f8-12fc-4b9c-b483-a77adedc3ec3)


### 🔎 캐시의 작동 방식

**✔️ 프로세서가 캐시에 필요한 데이터 블록이 있는지 확인하고, 있으면 캐시에서 가져와서 쓴다. `Cache Hit`** 

**✔️ 없으면 메인 메모리에서 필요한 데이터를 캐시로 올린다. `Cache Miss`**

### 🔎 **캐시 메모리 작동 원리**

**✔️캐시의 지역성**

지역성이란 기억장치 내 정보를 균일하게 접근하는 것이 아닌 어느 한순간에 특정 부분을 집중적으로 참조하는 특성. 데이터의 접근이 가깝게 일어나는 것을 의미하며 캐시가 효율적으로 동작하려면, 캐시의 적중률을 극대화시켜야한다.

▶️ **시간적 지역성**

`특정 데이터가 한 번 접근되었을 경우, 가까운 미래에 또 한 번 데이터에 접근할 가능성이 높은 것`

- for, while 같은 반복문에 사용되는 조건 변수처럼 한번 참조된 데이터는 잠시 후 또 참조될 가능성이 높다.

▶️ **공간적 지역성**

`특정 데이터와 가까운 주소가 순서대로 접근되었을 경우`

- A[0], A[1]과 같은 연속 접근 시, 참조된 데이터 근처에 있는 데이터가 잠시 후 또 사용될 가능성이 높다.

▶️ **순차적 지역성**

`데이터가 기억장치에 저장된 순서대로 인출되고 실행될 가능성이 높은 현상`

### 🔎 **캐시 미스 경우 3가지**

1. **Cold miss:** 해당 메모리 주소를 처음 불러서 나는 미스
2. **Conflict miss:** 캐시 메모리에 A와 B 데이터를 저장해야 하는데, A와 B가 같은 캐시 메모리 주소에 할당되어 있어서 나는 미스 (direct mapped cache에서 많이 발생)
    - 항상 핸드폰과 열쇠를 오른쪽 주머니에 넣고 다니는데, 잠깐 친구가 준 물건을 받느라 손에 들고 있던 핸드폰을 가방에 넣었음. 그 이후 핸드폰을 찾으려 오른쪽 주머니에서 찾는데 없는 상황
3. **Capacity miss:** 캐시 메모리의 공간이 부족해서 나는 미스 (Conflict는 주소 할당 문제, Capacity는 공간 문제)

### 캐시의 크기를 늘리면??

<aside>
💡 **문제 해결을 위해 캐시 크기를 키우면 캐시 접근속도가 느려지고 파워를 많이 먹는 단점 발생**

</aside>

### 🔎 메모리의 종류

▶️ **DRAM**

- 동적 램
- 주기억 장치에 주로 사용
- 가격이 싸고 용량 대비 크기가 작지만 속도가 느리다.
- 구조가 간단

▶️ **SRAM**

- 정적 램
- 속도가 빠르지만 가격이 비싸고 용량 대비 크기가 크다
- 빠른 속도가 요구되는 캐시 메모리에 주로 사용

### 🔎 캐시 메모리 **구조**

▶️ **레벨 구조**: 캐시 메모리는 보통 여러 레벨로 구성되며, 각 레벨은 CPU와의 물리적 거리 및 접근 속도에 따라 구분.

- **L1 캐시**: CPU 코어에 내장되어 있으며, 가장 빠르지만 용량이 작다.
- **L2 캐시**: L1 캐시보다 크지만 속도는 약간 느립니다. CPU 코어별로 독립적일 수도 있고, 공유될 수도 있다.
- **L3 캐시**: 여러 코어가 공유하는 경우가 많으며, L2 캐시보다 크고 상대적으로 느리다.
- **L4 캐시**: 일부 고급 프로세서에서만 사용되며, CPU 외부에 위치

▶️ **캐시 라인**: 캐시는 메모리 데이터를 일정한 크기의 블록으로 관리하며, 이를 캐시 라인(Cache Line)이라고 한다. 일반적으로 캐시 라인의 크기는 32바이트 또는 64바이트

▶️ **연관도**: 캐시는 특정 메모리 주소와 캐시 라인 간의 매핑을 정의하는 방식에 따라 연관도가 결정

- **직접 매핑(Direct Mapped)**: 하나의 메모리 주소는 캐시의 특정 위치에만 저장
- **완전 연관(Fully Associative)**: 메모리 주소는 캐시 내의 모든 위치에 저장
- **집합 연관(Set Associative)**: 캐시는 여러 개의 집합(Set)으로 나뉘며, 메모리 주소는 특정 집합 내의 여러 위치 중 하나에 저장

**캐시 메모리와 메인 메모리의 차이점은 무엇인가요?**

<aside>
💡캐시 메모리는 작은 용량이지만 매우 빠른 접근 속도를 제공하여, CPU와 메인 메모리 간의 속도 차이를 줄이는 데 사용됩니다. 반면, 메인 메모리는 더 큰 용량을 제공하여, 실행 중인 프로그램과 데이터를 저장하고 관리합니다.
</aside>
